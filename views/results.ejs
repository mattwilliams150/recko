<% layout('layout') %>
      
    <script>var data = <%- JSON.stringify(data) %></script>

    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-6 py-5 p-xl-5">
          <h1 class="mb-4"><%= type %> in <%= place %></h1>
          <hr class="my-4">
          <form action="#">
            <div class="row">

            <div class="col-xl-4 col-md-6 mb-4">
                <label class="form-label" for="place">Place</label>
                <select class="selectpicker form-control" name="type" id="form_type" data-style="btn-selectpicker" data-live-search="true" data-selected-text-format="count &gt; 1" title="" onchange="updateCategories()">

                <option>Restaurants</option>
                <option>Pubs</option>
                <option>Cafes</option>
                <option>Bars</option>
                <option>Activities</option>

                </select>
              </div>

              <div class="col-xl-4 col-md-6 mb-4">
                <label class="form-label" for="place">Place</label>
                <select class="selectpicker form-control" name="place" id="form_place" data-style="btn-selectpicker" data-live-search="true" data-selected-text-format="count &gt; 1" title="">

                    <% for (i=0; i<data.locations.locations.length; i++) { %>
                        <option><%=data.locations.locations[i]%></option>
                    <% } %>

                </select>
              </div>
              <div class="col-xl-4 col-md-6 mb-4">

                <% if (type == "Restaurants") { var categories = data.categories.cuisines %>
                <label class="form-label" for="form_category">Cuisine</label>
                <% } else if (type == "Bars") { var categories = data.categories.bars %>
                <label class="form-label" for="form_category">Category</label>
                <% } else { var categories = data.categories.thingsToDo %>
                <label class="form-label" for="form_category">Category</label>
                  <% } console.log(categories)%>
                <select class="selectpicker form-control" name="category" id="form_category" multiple data-style="btn-selectpicker" data-selected-text-format="count &gt; 1" title="">
                    <% for (i=0; i<categories.length; i++) { %>
                        <option><%=categories[i]%></option>
                    <% } %>
                </select>
              </div>

              <div class="col-12 pb-4">
                <div class="collapse" id="moreFilters">
                   <div class="col-12 mb-4">
                    <label class="form-label">Tag</label>
                    <ul class="list-inline mb-0">

                     <% for (i=0; i<data.categories.tags.length; i++) { %>
                      <li class="list-inline-item">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="type_0" name="type[]">
                          <label class="custom-control-label" for="type_0"><%=data.categories.tags[i]%></label>
                        </div>
                      </li>
                       <% } %>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-6 mb-4">
                <button class="btn btn-primary" type="submit"> <i class="fas fa-filter mr-1"></i>Filter                </button>
              </div>
              <div class="col-6 mb-4 text-right">
                <button class="btn btn-link btn-collapse pl-0 text-secondary" type="button" data-toggle="collapse" data-target="#moreFilters" aria-expanded="false" aria-controls="moreFilters" data-expanded-text="Filter by Tag" data-collapsed-text="Filter by Tag">Filter by Tag</button>
              </div>
            </div>
          </form>
          <hr class="my-4">
          <div class="d-flex justify-content-between align-items-center flex-column flex-md-row mb-4">
            <div class="mr-3">
              <p class="mb-3 mb-md-0"><strong><%= data.pagination.totalRecords %></strong> results found</p>
            </div>
            <div>
              <label class="form-label mr-2" for="form_sort">Sort by</label>
              <select class="selectpicker" name="sort" id="form_sort" data-style="btn-selectpicker" title="">
                <option value="sortBy_0">Most popular   </option>
                <option value="sortBy_1">Recommended   </option>
                <option value="sortBy_2">Newest   </option>
                <option value="sortBy_3">Oldest   </option>
                <option value="sortBy_4">Closest   </option>
              </select>
            </div>
          </div>
          <div class="row">
            
            <% for (i = 0; i < data.places.length; i++) { %>
            <!-- venue item-->
              <a href='/listing?placeid=<%= data.places[i].placeId %>'>
            <div class="col-sm-6 mb-4 hover-animate" data-marker-id="<%= data.places[i].placeId %>">
                
              <div class="card h-100 border-0 shadow" id="<%= data.places[i].placeId %>">
                <div class="card-img-top overflow-hidden dark-overlay bg-cover" style="background-image: url(https://maps.googleapis.com/maps/api/place/photo?maxheight=227&photoreference=photo_reference&key=clientPlacesApiKey%>); min-height: 200px;">
                  <div class="card-img-overlay-bottom z-index-20">
                    <h4 class="text-white text-shadow"><%= data.places[i].placeName %></h4>
                    <p class="mb-2 text-xs">
                        <%  
                             
                            for (j = 0; j < 5; j++) {
                                if (Math.round(data.places[i].review) > j) {  %>
                                    <i class="fa fa-star text-warning"></i>
                                <% } else { %>
                                    <i class="fa fa-star text-gray-300"></i>
                                <% } %>
                                             
                        <% } %>
                    </p>
                  </div>
                  <div class="card-img-overlay-top d-flex justify-content-between align-items-center">
                    <div class="badge badge-transparent badge-pill px-3 py-2"><%= data.places[i].type%></div>
                      <% if (false) { /*favorite icon*/ %>
                      <a class="card-fav-icon position-relative z-index-40" href="javascript: void();">
                      <svg class="svg-icon text-white">
                        <use xlink:href="#heart-1"> </use>
                      </svg>
                      </a>
                      <% } %>
                  </div>
                </div>
                <div class="card-body">
                  <p class="text-sm mb-0">
                      <a class="mr-1 badge badge-pill tag-pill"><%= data.places[i].tag1%></a>
                      <a class="mr-1 badge badge-pill tag-pill"><%= data.places[i].tag2%></a>
                      <a class="mr-1 badge badge-pill tag-pill"><%= data.places[i].tag3%></a>
                  </p>
                </div>
              </div>
                
            </div>
                </a>
            <% } %>  
              

          </div>
          <!-- Pagination -->
          <nav aria-label="Page navigation example">
            <ul class="pagination pagination-template d-flex justify-content-center">
            <% if (data.pagination.previousPage !== undefined) { %>
                <li class="page-item"><a class="page-link" onClick="pageChange(<%= data.pagination.previousPage %>)"> <i class="fa fa-angle-left"></i></a></li>
                <li class="page-item"><a class="page-link" onClick="pageChange(<%= data.pagination.previousPage %>)"><%= data.pagination.previousPage %></a></li>
            <% } %>
            <% if (data.pagination.maxPage !== 1) { %>
                <li class="page-item active "><a class="page-link"><%= data.pagination.currentPage %></a></li>
            <% } %>
            <% if (data.pagination.nextPage !== undefined) { %>
                <li class="page-item"><a class="page-link" onClick="pageChange(<%= data.pagination.nextPage %>)"><%= data.pagination.nextPage %></a></li>
                <li class="page-item"><a class="page-link" onClick="pageChange(<%= data.pagination.nextPage %>)"> <i class="fa fa-angle-right"></i></a></li>
            <% } %>
            </ul>
          </nav>
        </div>
        <div class="col-lg-6 map-side-lg pr-lg-0">
          <div class="map-full shadow-left" id="categorySideMap"></div>
        </div>
      </div>
    </div>

    <script src="js/map.js"></script>

    <script>
    function pageChange(page) {
        window.location.href =
            'results?'
            + 'type=' + encodeURI(data.parameters.type)
            + '&place=' + encodeURI(data.parameters.place)
            + '&page=' + page
    }

    </script>

    <script>

      createMap({
          mapId: 'categorySideMap',
      },places);
      
    </script>

    <!-- Price Slider-->
    <script src="vendor/nouislider/nouislider.min.js"></script>
    <script>
      var snapSlider = document.getElementById('slider-snap');
      
      noUiSlider.create(snapSlider, {
          start: [ 40, 110 ],
          snap: false,
          connect: true,
          step: 1,
          range: {
              'min': 40,
              'max': 110
          }
      });
      var snapValues = [
          document.getElementById('slider-snap-value-from'),
          document.getElementById('slider-snap-value-to')
      ];
      var inputValues = [
          document.getElementById('slider-snap-input-from'),
          document.getElementById('slider-snap-input-to')
      ];
      snapSlider.noUiSlider.on('update', function( values, handle ) {
          snapValues[handle].innerHTML = values[handle];
          inputValues[handle].value = values[handle];
      })
    </script>
